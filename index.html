<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Magic 8 Ball</title>
  <script src="https://telegram.org/js/telegram-web-app.js?v=8.0"></script>
  <style>
    /* Reset & Base Styles */
    * { box-sizing: border-box; }
    
    body { 
      background: #1a1a1a; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center; 
      height: 100vh; 
      margin: 0; 
      color: white; 
      font-family: sans-serif; 
      overflow: hidden;
      touch-action: none;
    }

    /* Main Ball Container */
    #ball { 
      width: 300px; 
      height: 300px; 
      background: radial-gradient(circle at 30% 30%, #444, #000); 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      position: relative; 
      box-shadow: 0 20px 50px rgba(0,0,0,0.9);
      transition: transform 0.1s ease-out;
      will-change: transform, filter;
      overflow: hidden;
    }

    /* Grain/Noise Overlay */
    #ball::before {
      content: '';
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.60' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      opacity: 0.08;
      pointer-events: none;
      mix-blend-mode: overlay;
      z-index: 1;
    }

    /* Ball Window (The Portal) */
    #window { 
      width: 170px; 
      height: 170px; 
      background: #020202; 
      border-radius: 50%; 
      border: 12px solid #222; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      position: relative;
      overflow: hidden; 
      box-shadow: inset 0 0 35px rgba(0,0,0,1);
      z-index: 2;
    }

    #triangle-container {
      position: absolute;
      width: 180px; 
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity 1.8s cubic-bezier(0.22, 1, 0.36, 1), transform 0.3s ease-out;
      will-change: transform, opacity;
    }

    #triangle {
      width: 175px;
      height: 165px;
      background: radial-gradient(circle at 50% 60%, #1e3d2b 0%, #142b1e 50%, #0a140e 100%);
      clip-path: path('M87.5 5 C110 50 175 130 175 145 C175 160 140 160 87.5 160 C35 160 0 160 0 145 C0 130 65 50 87.5 5 Z');
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: inset 0 -10px 20px rgba(0,0,0,0.5);
      filter: drop-shadow(0 0 12px rgba(0,0,0,0.8));
      overflow: hidden;
    }

    #triangle::before {
      content: '';
      position: absolute;
      top: -50%; left: -50%; width: 200%; height: 200%;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      opacity: 0.12;
      pointer-events: none;
      mix-blend-mode: overlay;
    }

    #answer { 
      position: absolute;
      top: 70px;
      color: #a8caff; 
      font-weight: bold; 
      font-size: 14px; 
      text-align: center;
      width: 100px;
      line-height: 1.1;
      text-transform: uppercase; 
      text-shadow: 0 0 8px rgba(127, 176, 255, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      height: 60px;
      transform: perspective(100px) rotateX(10deg);
    }

    #answer.initial {
      font-size: 70px;
      top: 60px; 
      height: 80px;
      width: 100%;
      transform: none;
    }

    /* Animations */
    .shake-anim { 
      animation: realisticShake 0.4s infinite alternate; 
      filter: blur(1px);
    }

    @keyframes realisticShake {
      0% { transform: translate(0, 0) rotate(0deg); }
      25% { transform: translate(8px, -4px) rotate(2deg); }
      50% { transform: translate(-10px, 6px) rotate(-3deg); }
      75% { transform: translate(6px, 10px) rotate(1.5deg); }
      100% { transform: translate(-4px, -8px) rotate(-1deg); }
    }

    /* UI Elements */
    #instruction {
      margin-top: 40px;
      font-size: 16px;
      text-align: center;
      padding: 0 20px;
      color: #888;
      max-width: 280px;
      line-height: 1.4;
    }

    #desktop-btn {
      margin-top: 30px;
      padding: 15px 45px;
      border-radius: 35px;
      border: none;
      background: linear-gradient(135deg, #1e3d2b, #0a140e);
      color: white;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
      transition: transform 0.1s;
    }

    #desktop-btn:active {
      transform: scale(0.95);
    }
  </style>
</head>
<body>

  <div id="ball">
    <div id="window">
      <div id="triangle-container">
        <div id="triangle">
          <div id="answer" class="initial">?</div>
        </div>
      </div>
    </div>
  </div>

  <div id="instruction"></div>
  <button id="desktop-btn">ÐŸÐžÐ¢Ð Ð¯Ð¡Ð¢Ð˜ ðŸŽ±</button>

  <script>
    const tg = window.Telegram.WebApp;
    
    // Configuration
    const ANSWERS = [
      "Ð—Ð°Ð¿Ð¸Ñ‚Ð°Ð¹ Ð¿Ñ–Ð·Ð½Ñ–ÑˆÐµ", "Ð¢Ð°Ðº, Ð±ÐµÐ·Ð¿ÐµÑ€ÐµÑ‡Ð½Ð¾", "ÐÐµ Ð´ÑƒÐ¶Ðµ Ð´Ð¾Ð±Ñ€Ñ– Ð¿ÐµÑ€ÑÐ¿ÐµÐºÑ‚Ð¸Ð²Ð¸",
      "ÐœÐ¾Ð¶ÐµÑˆ Ð½Ð° Ñ†Ðµ Ð¿Ð¾ÐºÐ»Ð°ÑÑ‚Ð¸ÑÑ", "ÐœÐ¾Ñ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ â€” Ð½Ñ–", "Ð¦Ðµ Ð±ÐµÐ·ÑÑƒÐ¼Ð½Ñ–Ð²Ð½Ð¾",
      "ÐÐ°Ñ€Ð°Ð·Ñ– Ð½ÐµÐ¼Ð¾Ð¶Ð»Ð¸Ð²Ð¾ Ð¿ÐµÑ€ÐµÐ´Ð±Ð°Ñ‡Ð¸Ñ‚Ð¸", "Ð—Ð½Ð°ÐºÐ¸ Ð²ÐºÐ°Ð·ÑƒÑŽÑ‚ÑŒ Ð½Ð° Â«Ñ‚Ð°ÐºÂ»", "Ð”ÑƒÐ¶Ðµ ÑÑƒÐ¼Ð½Ñ–Ð²Ð½Ð¾",
      "Ð¯Ðº Ð½Ð° Ð¼ÐµÐ½Ðµ â€” Ñ‚Ð°Ðº", "Ð—Ð¾ÑÐµÑ€ÐµÐ´ÑŒÑÑ Ñ– Ð·Ð°Ð¿Ð¸Ñ‚Ð°Ð¹ Ð·Ð½Ð¾Ð²Ñƒ", "Ð¢Ð°Ðº",
      "ÐœÐ¾Ñ— Ð´Ð¶ÐµÑ€ÐµÐ»Ð° ÐºÐ°Ð¶ÑƒÑ‚ÑŒ Â«Ð½Ñ–Â»", "Ð‘ÐµÐ· Ð¶Ð¾Ð´Ð½Ð¸Ñ… ÑÑƒÐ¼Ð½Ñ–Ð²Ñ–Ð²", "Ð‘Ð°Ñ‡ÐµÐ½Ð½Ñ Ð½ÐµÑ‡Ñ–Ñ‚ÐºÐµ",
      "ÐÐµ Ñ€Ð¾Ð·Ñ€Ð°Ñ…Ð¾Ð²ÑƒÐ¹ Ð½Ð° Ñ†Ðµ", "Ð¥Ð¾Ñ€Ð¾ÑˆÑ– Ð¿ÐµÑ€ÑÐ¿ÐµÐºÑ‚Ð¸Ð²Ð¸", "Ð¡Ð°Ð¼Ðµ Ñ‚Ð°Ðº",
      "ÐšÑ€Ð°Ñ‰Ðµ Ð½Ðµ ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ñ‚Ð¾Ð±Ñ– Ð·Ð°Ñ€Ð°Ð·", "ÐÐ°Ð¹Ñ–Ð¼Ð¾Ð²Ñ–Ñ€Ð½Ñ–ÑˆÐµ"
    ];

    // State
    let isShaking = false;
    let resetTimer;
    let targetX = 0, targetY = 0;
    let currentX = 0, currentY = 0;
    let currentTilt = 0;

    // Elements
    const ball = document.getElementById('ball');
    const container = document.getElementById('triangle-container');
    const ansText = document.getElementById('answer');
    const instruction = document.getElementById('instruction');
    const btn = document.getElementById('desktop-btn');

    // Initialize WebApp
    tg.ready();
    tg.expand();

    function initTelegramSensors() {
      if (tg.Accelerometer) {
        tg.Accelerometer.start({ refresh_rate: 20 }, (success) => {
          if (success) {
            instruction.innerText = "Ð—Ð¾ÑÐµÑ€ÐµÐ´ÑŒÑÑ Ð½Ð° Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ– Ñ‚Ð° Ð¿Ð¾Ñ‚Ñ€ÑÑÐ¸ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½ðŸ“±";
            tg.onEvent('accelerometerChanged', () => {
              const { x, y, z } = tg.Accelerometer;
              const totalAcc = Math.sqrt(x*x + y*y + z*z);
              if (totalAcc > 22 && !isShaking) shakeBall();
            });
          }
        });
      }

      if (tg.DeviceOrientation) {
        tg.DeviceOrientation.start({ refresh_rate: 40 }, (success) => {
          if (success) {
            tg.onEvent('deviceOrientationChanged', () => {
              if (isShaking) return;
              
              const { gamma, beta } = tg.DeviceOrientation;
              const orientation = window.orientation || 0;

              let rawX, rawY;
              if (orientation === 90) {
                rawX = -(beta - 45); rawY = gamma;
              } else if (orientation === -90) {
                rawX = (beta - 45); rawY = -gamma;
              } else {
                rawX = gamma; rawY = (beta - 45);
              }

              targetX = Math.max(-25, Math.min(25, (rawX || 0)));
              targetY = Math.max(-25, Math.min(25, (rawY || 0)));
            });
          }
        });
      }
    }

    function shakeBall() {
      if (isShaking) return;
      isShaking = true;
      
      clearTimeout(resetTimer);
      container.style.opacity = "0";
      ball.classList.add('shake-anim');
      
      if (tg.HapticFeedback) {
        tg.HapticFeedback.notificationOccurred('success');
      }

      setTimeout(() => {
        ball.classList.remove('shake-anim');
        ansText.innerText = ANSWERS[Math.floor(Math.random() * ANSWERS.length)];
        ansText.className = ""; 
        currentTilt = (Math.random() * 10 - 5); 
        container.style.opacity = "1";
        isShaking = false;
        resetTimer = setTimeout(resetBall, 10000);
      }, 800);
    }

    function resetBall() {
      container.style.opacity = "0";
      setTimeout(() => {
        ansText.innerText = "?";
        ansText.className = "initial";
        currentTilt = 0;
        container.style.opacity = "1";
      }, 600);
    }

    function animate() {
      if (!isShaking) {
        currentX += (targetX - currentX) * 0.15;
        currentY += (targetY - currentY) * 0.15;
        const drift = Math.sin(Date.now() / 800) * 3;
        container.style.transform = `translate(${currentX}px, ${currentY + drift}px) rotate(${currentTilt}deg)`;
      }
      requestAnimationFrame(animate);
    }

    // Platform detection
    const isMobile = ['android', 'ios'].includes(tg.platform);
    if (isMobile && tg.version >= "8.0") {
	  btn.style.display = 'none';
      initTelegramSensors();
    } else {
	  btn.style.display = 'block';
      instruction.innerText = "ÐÐ°Ñ‚Ð¸ÑÐ½Ñ–Ñ‚ÑŒ ÐºÐ½Ð¾Ð¿ÐºÑƒ, Ñ‰Ð¾Ð± Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ";
    }

    // Events
    btn.onclick = shakeBall;
    
    // Start animation loop
    animate();

    // Cleanup
    window.addEventListener('beforeunload', () => {
      if (tg.Accelerometer) tg.Accelerometer.stop();
      if (tg.DeviceOrientation) tg.DeviceOrientation.stop();
    });
  </script>
</body>
</html>
