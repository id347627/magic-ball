<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://telegram.org/js/telegram-web-app.js?v=8.0"></script>
  <style>
    body { 
      background: #1a1a1a; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center; 
      height: 100vh; 
      margin: 0; 
      color: white; 
      font-family: sans-serif; 
      overflow: hidden;
      touch-action: none;
    }

    #ball { 
      width: 300px; 
      height: 300px; 
      background: radial-gradient(circle at 30% 30%, #444, #000); 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      position: relative; 
      box-shadow: 0 20px 50px rgba(0,0,0,0.9);
      transition: transform 0.1s ease-out;
      will-change: transform, filter;
    }

    #window { 
      width: 170px; 
      height: 170px; 
      background: #020202; 
      border-radius: 50%; 
      border: 12px solid #222; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      position: relative;
      overflow: hidden; 
      box-shadow: inset 0 0 35px rgba(0,0,0,1);
    }

    #triangle-container {
      position: absolute;
      width: 240px; 
      height: 240px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s ease-out, opacity 1.8s cubic-bezier(0.22, 1, 0.36, 1);
      will-change: transform, opacity;
      /* –ü–æ—á–∞—Ç–∫–æ–≤–µ —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è */
      transform: translate(0, 0); 
    }

    #triangle {
      width: 220px;
      height: 190px;
      background: radial-gradient(circle at 50% 60%, #2a4fa3 0%, #1a3a8a 50%, #0e1e4d 100%);
      
      /* –í–∏–≥–Ω—É—Ç–∞ —Ñ–æ—Ä–º–∞ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ */
      clip-path: path('M110 0 C140 60 220 150 220 170 C220 190 180 190 110 190 C40 190 0 190 0 170 C0 150 80 60 110 0 Z');
      
      position: relative;
      display: flex;
      justify-content: center;
      
      /* margin-top –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Ç–∞–∫, —â–æ–± —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫ –±—É–≤ —É —Ü–µ–Ω—Ç—Ä—ñ –≤—ñ–∫–Ω–∞ (170px) */
      /* —ñ –≤—Å—ñ –∫—Ä–∞—ó —Ö–æ–≤–∞–ª–∏—Å—è –æ–¥–Ω–∞–∫–æ–≤–æ */
      margin-top: -15px; 
      
      box-shadow: inset 0 -10px 20px rgba(0,0,0,0.5);
      filter: drop-shadow(0 0 12px rgba(0,0,0,0.8));
      overflow: hidden;
    }

    /* –®–∞—Ä –∑–µ—Ä–Ω–∏—Å—Ç–æ—Å—Ç—ñ */
    #triangle::before {
      content: '';
      position: absolute;
      top: -50%; left: -50%; width: 200%; height: 200%;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      opacity: 0.12;
      pointer-events: none;
      mix-blend-mode: overlay;
    }

    #triangle::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
      pointer-events: none;
    }

    #answer { 
      position: absolute;
      top: 65px; 
      color: #a8caff; 
      font-weight: bold; 
      font-size: 14px; 
      text-align: center;
      width: 115px;
      line-height: 1.1;
      text-transform: uppercase; 
      text-shadow: 0 0 8px rgba(127, 176, 255, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      height: 70px;
    }

    #answer.initial {
      font-size: 70px;
      top: 55px; 
      height: 90px;
      width: 100%;
    }

    .shake-anim { 
      animation: realisticShake 0.4s infinite alternate; 
      filter: blur(1px); 
    }

    @keyframes realisticShake {
      0% { transform: translate(0, 0) rotate(0deg); }
      25% { transform: translate(8px, -4px) rotate(2deg); }
      50% { transform: translate(-10px, 6px) rotate(-3deg); }
      75% { transform: translate(6px, 10px) rotate(1.5deg); }
      100% { transform: translate(-4px, -8px) rotate(-1deg); }
    }

    #instruction {
      margin-top: 40px;
      font-size: 14px;
      text-align: center;
      padding: 0 20px;
      color: #888;
      max-width: 280px;
      line-height: 1.4;
    }

    #desktop-btn {
      margin-top: 30px;
      padding: 15px 45px;
      border-radius: 35px;
      border: none;
      background: linear-gradient(135deg, #4080ff, #1a3a8a);
      color: white;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    }
  </style>
</head>
<body>

  <div id="ball">
    <div id="window">
      <div id="triangle-container">
        <div id="triangle">
          <div id="answer" class="initial">?</div>
        </div>
      </div>
    </div>
  </div>

  <div id="instruction"></div>
  <button id="desktop-btn">–ü–û–¢–†–Ø–°–¢–ò üé±</button>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    const answers = [
        "–ó–∞–ø–∏—Ç–∞–π –ø—ñ–∑–Ω—ñ—à–µ", "–¢–∞–∫, –±–µ–∑–ø–µ—Ä–µ—á–Ω–æ", "–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∏ –Ω–µ –¥—É–∂–µ –¥–æ–±—Ä—ñ",
        "–ú–æ–∂–µ—à –Ω–∞ —Ü–µ –ø–æ–∫–ª–∞—Å—Ç–∏—Å—è", "–ú–æ—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å ‚Äî –Ω—ñ", "–¶–µ –±–µ–∑—Å—É–º–Ω—ñ–≤–Ω–æ",
        "–ù–∞—Ä–∞–∑—ñ –Ω–µ–º–æ–∂–ª–∏–≤–æ –ø–µ—Ä–µ–¥–±–∞—á–∏—Ç–∏", "–ó–Ω–∞–∫–∏ –≤–∫–∞–∑—É—é—Ç—å –Ω–∞ ¬´—Ç–∞–∫¬ª", "–î—É–∂–µ —Å—É–º–Ω—ñ–≤–Ω–æ",
        "–Ø–∫ –Ω–∞ –º–µ–Ω–µ ‚Äî —Ç–∞–∫", "–ó–æ—Å–µ—Ä–µ–¥—å—Å—è —ñ –∑–∞–ø–∏—Ç–∞–π –∑–Ω–æ–≤—É", "–¢–∞–∫",
        "–ú–æ—ó –¥–∂–µ—Ä–µ–ª–∞ –∫–∞–∂—É—Ç—å ¬´–Ω—ñ¬ª", "–ë–µ–∑ –∂–æ–¥–Ω–∏—Ö —Å—É–º–Ω—ñ–≤—ñ–≤", "–ë–∞—á–µ–Ω–Ω—è –Ω–µ—á—ñ—Ç–∫–µ, —Å–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑",
        "–ù–µ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É–π –Ω–∞ —Ü–µ", "–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∏ —Ö–æ—Ä–æ—à—ñ", "–°–∞–º–µ —Ç–∞–∫",
        "–ö—Ä–∞—â–µ –Ω–µ –∫–∞–∑–∞—Ç–∏ —Ç–æ–±—ñ –∑–∞—Ä–∞–∑", "–ù–∞–π—ñ–º–æ–≤—ñ—Ä–Ω—ñ—à–µ"
    ];

    let isShaking = false;
    let resetTimer;
    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–µ –∑–º—ñ—â–µ–Ω–Ω—è –≤—ñ–¥ –Ω–∞—Ö–∏–ª—É
    let tiltX = 0;
    let tiltY = 0;
    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∏–ø–∞–¥–∫–æ–≤–µ –∑–º—ñ—â–µ–Ω–Ω—è –ø—ñ—Å–ª—è —Ç—Ä—è—Å—ñ–Ω–Ω—è
    let floatX = 0;
    let floatY = 0;
    let floatRotation = 0;

    const ball = document.getElementById('ball');
    const container = document.getElementById('triangle-container');
    const ansText = document.getElementById('answer');
    const instruction = document.getElementById('instruction');
    const btn = document.getElementById('desktop-btn');

    function updateContainerTransform() {
      // –ö–æ–º–±—ñ–Ω—É—î–º–æ –Ω–∞—Ö–∏–ª —Ç–µ–ª–µ—Ñ–æ–Ω—É + –≤–∏–ø–∞–¥–∫–æ–≤–∏–π –¥—Ä–µ–π—Ñ —É —Ä—ñ–¥–∏–Ω—ñ
      container.style.transform = `translate(${tiltX + floatX}px, ${tiltY + floatY}px) rotate(${floatRotation}deg)`;
    }

    function initTelegramSensors() {
      if (tg.Accelerometer) {
        tg.Accelerometer.start({ refresh_rate: 20 }, (success) => {
          if (success) {
            instruction.innerText = "–ó–æ—Å–µ—Ä–µ–¥—å—Å—è –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—ñ —Ç–∞ –ø–æ—Ç—Ä—è—Å–∏ —Ç–µ–ª–µ—Ñ–æ–Ωüì±";
            tg.onEvent('accelerometerChanged', () => {
              const { x, y, z } = tg.Accelerometer;
              const totalAcc = Math.sqrt(x*x + y*y + z*z);
              if (totalAcc > 22 && !isShaking) shakeBall();
            });
          }
        });
      }

      if (tg.DeviceOrientation) {
        tg.DeviceOrientation.start({ refresh_rate: 40 }, (success) => {
          if (success) {
            tg.onEvent('deviceOrientationChanged', () => {
              if (isShaking) return;
              const { gamma, beta } = tg.DeviceOrientation;
              // –ß—É—Ç–ª–∏–≤—ñ—Å—Ç—å –Ω–∞—Ö–∏–ª—É (–¥—ñ–ª–∏–º–æ –Ω–∞ 2 –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç—ñ)
              tiltX = (gamma || 0) / 2;
              tiltY = (beta - 45) / 2;
              updateContainerTransform();
            });
          }
        });
      }
    }

    function shakeBall() {
      if (isShaking) return;
      isShaking = true;
      clearTimeout(resetTimer);
      
      container.style.opacity = "0";
      ball.classList.add('shake-anim');

      if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');

      setTimeout(() => {
        ball.classList.remove('shake-anim');
        
        const randomAnswer = answers[Math.floor(Math.random() * answers.length)];
        ansText.innerText = randomAnswer;
        ansText.className = ""; 

        // –î–æ–¥–∞—î–º–æ –µ—Ñ–µ–∫—Ç "–∑–∞–≤–∏—Å–∞–Ω–Ω—è" –≤ –Ω–æ–≤–æ–º—É –ø–æ–ª–æ–∂–µ–Ω–Ω—ñ
        floatRotation = (Math.random() * 10 - 5);
        floatX = (Math.random() * 14 - 7);
        floatY = (Math.random() * 10 - 5);

        updateContainerTransform();
        container.style.opacity = "1";

        isShaking = false;
        resetTimer = setTimeout(resetBall, 10000);
      }, 800);
    }

    function resetBall() {
      container.style.opacity = "0";
      setTimeout(() => {
        ansText.innerText = "?";
        ansText.className = "initial";
        floatX = 0; floatY = 0; floatRotation = 0;
        updateContainerTransform();
        container.style.opacity = "1";
      }, 600);
    }

    const isMobile = ['android', 'ios'].includes(tg.platform);
    if (isMobile) {
      if (tg.version >= "8.0") initTelegramSensors();
      else instruction.innerText = "–û–Ω–æ–≤—ñ—Ç—å Telegram –¥–ª—è —Å–µ–Ω—Å–æ—Ä—ñ–≤.";
    } else {
      instruction.innerText = "–ó–æ—Å–µ—Ä–µ–¥—å—Å—è –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—ñ —Ç–∞ –Ω–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É.";
    }

    btn.onclick = shakeBall;

    window.addEventListener('beforeunload', () => {
      if (tg.Accelerometer) tg.Accelerometer.stop();
      if (tg.DeviceOrientation) tg.DeviceOrientation.stop();
    });
  </script>
</body>
</html>
