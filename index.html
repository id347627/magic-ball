<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { 
      background: #1a1a1a; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center; 
      height: 100vh; 
      margin: 0; 
      color: white; 
      font-family: sans-serif; 
      overflow: hidden;
      touch-action: none;
    }

    #ball { 
      width: 300px; 
      height: 300px; 
      background: radial-gradient(circle at 30% 30%, #444, #000); 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      position: relative; 
      box-shadow: 0 20px 50px rgba(0,0,0,0.9);
    }

    #window { 
      width: 170px; 
      height: 170px; 
      background: #020202; 
      border-radius: 50%; 
      border: 12px solid #222; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      position: relative;
      overflow: hidden; 
      box-shadow: inset 0 0 35px rgba(0,0,0,1);
    }

    #triangle-container {
      position: absolute;
      width: 200px; 
      height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.15s ease-out, opacity 0.6s ease-in-out;
      will-change: transform;
    }

    #triangle {
      width: 0;
      height: 0;
      /* –¢—Ä–æ—Ö–∏ –º–µ–Ω—à—ñ —Ä–æ–∑–º—ñ—Ä–∏: 105px (—Ä–∞–∑–æ–º 210px) –ø—Ä–∏ –≤—ñ–∫–Ω—ñ 170px */
      border-left: 105px solid transparent;
      border-right: 105px solid transparent;
      border-bottom: 180px solid #1a3a8a;
      position: relative;
      display: flex;
      justify-content: center;
      /* –ó–º—ñ—â–µ–Ω–Ω—è –≤–≥–æ—Ä—É, —â–æ–± –≤–µ—Ä—Ö–Ω—ñ–π –∫—ñ–Ω—á–∏–∫ –∑–∞–π—à–æ–≤ –∑–∞ –∫—Ä–∞–π */
      margin-top: -35px; 
      filter: drop-shadow(0 0 15px rgba(0,0,0,0.6));
    }

    #answer { 
      position: absolute;
      /* –î–ª—è —Ç–µ–∫—Å—Ç—É –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π */
      top: 80px; 
      color: #7fb0ff; 
      font-weight: bold; 
      font-size: 13px; 
      text-align: center;
      width: 100px;
      line-height: 1.2;
      text-transform: uppercase; 
      text-shadow: 0 0 10px #4080ff;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 60px;
    }

    /* –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Å—Ç–∏–ª—å –¥–ª—è —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –∑–Ω–∞–∫–∞ –ø–∏—Ç–∞–Ω–Ω—è */
    #answer.initial {
      font-size: 70px;
      top: 65px; 
      height: 80px;
      width: 100%;
    }

    .shake-anim { animation: shakeEffect 0.4s infinite; }
    @keyframes shakeEffect {
      0% { transform: translate(0,0); }
      25% { transform: translate(12px, 12px); }
      50% { transform: translate(-12px, 12px); }
      75% { transform: translate(12px, -12px); }
      100% { transform: translate(0,0); }
    }

    #instruction {
      margin-top: 40px;
      font-size: 16px;
      text-align: center;
      padding: 0 20px;
      color: #666;
      max-width: 250px;
    }

    #desktop-btn {
      display: none;
      margin-top: 30px;
      padding: 15px 45px;
      border-radius: 35px;
      border: none;
      background: linear-gradient(135deg, #4080ff, #1a3a8a);
      color: white;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    }
  </style>
</head>
<body>

  <div id="ball">
    <div id="window">
      <div id="triangle-container">
        <div id="triangle">
          <div id="answer" class="initial">?</div>
        </div>
      </div>
    </div>
  </div>

  <div id="instruction"></div>
  <button id="desktop-btn" onclick="shakeBall()">–ü–û–¢–†–Ø–°–¢–ò üé±</button>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    const answers = [
      "–ë–µ–∑–ø–µ—Ä–µ—á–Ω–æ", "–¢–∞–∫", "–ú–æ–∂–µ—à –±—É—Ç–∏ –≤–ø–µ–≤–Ω–µ–Ω–∏–π", "–ú–µ–Ω—ñ –∑–¥–∞—î—Ç—å—Å—è ‚Äî —Ç–∞–∫", "–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∏ —Ö–æ—Ä–æ—à—ñ",
      "–ó–∞–ø–∏—Ç–∞–π –ø—ñ–∑–Ω—ñ—à–µ", "–ó–∞—Ä–∞–∑ –Ω–µ –º–æ–∂—É —Å–∫–∞–∑–∞—Ç–∏", "–ö—Ä–∞—â–µ –Ω–µ —Ä–æ–∑–ø–æ–≤—ñ–¥–∞—Ç–∏",
      "–ù–∞–≤—ñ—Ç—å –Ω–µ –¥—É–º–∞–π", "–ú–æ—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å ‚Äî –Ω—ñ", "–ü–æ–≥–∞–Ω—ñ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∏", "–í–µ–ª—å–º–∏ —Å—É–º–Ω—ñ–≤–Ω–æ"
    ];

    let isShaking = false;
    let sensorsActive = false; // –ü—Ä–∞–ø–æ—Ä –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó —Å–µ–Ω—Å–æ—Ä—ñ–≤
    let resetTimer;
    const ball = document.getElementById('ball');
    const container = document.getElementById('triangle-container');
    const ansText = document.getElementById('answer');
    const instruction = document.getElementById('instruction');
    const btn = document.getElementById('desktop-btn');

    // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ —Å—Ç–∞–Ω—É —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
    if (isMobileDevice()) {
      instruction.innerText = "–ó–æ—Å–µ—Ä–µ–¥—å—Å—è –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—ñ —Ç–∞ –ø–æ—Ç—Ä—è—Å–∏ —Ç–µ–ª–µ—Ñ–æ–Ω üì±";
      btn.innerText = "–ì–†–ê–¢–ò üé±"; // –î–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö —Ü–µ –∫–Ω–æ–ø–∫–∞-–∞–∫—Ç–∏–≤–∞—Ç–æ—Ä
    } else {
      instruction.innerText = "–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å";
    }
    btn.style.display = 'block';

    function isMobileDevice() {
      const platform = tg.platform.toLowerCase();
      const hasTouch = (('ontouchstart' in window) || (navigator.maxTouchPoints > 0));
      return ['android', 'ios', 'weba'].includes(platform) || (hasTouch && platform !== 'desktop');
    }

    // –ì–û–õ–û–í–ù–ê –§–£–ù–ö–¶–Ü–Ø: –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—É (–≤–∫–ª—é—á–∞—î –∑–∞–ø–∏—Ç –¥–ª—è iOS)
    async function handleButtonClick() {
      // –Ø–∫—â–æ —Ü–µ iOS —ñ —Å–µ–Ω—Å–æ—Ä–∏ —â–µ –Ω–µ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω—ñ
      if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
        try {
          const permission = await DeviceMotionEvent.requestPermission();
          if (permission === 'granted') {
            activateSensors();
            instruction.innerText = "–î–æ—Å—Ç—É–ø –æ—Ç—Ä–∏–º–∞–Ω–æ! –¢–µ–ø–µ—Ä –º–æ–∂–µ—à –ø—Ä–æ—Å—Ç–æ —Ç—Ä—è—Å—Ç–∏ üì±";
          }
        } catch (e) {
          console.error("iOS Sensor Error:", e);
        }
      } else if (!sensorsActive) {
        // –î–ª—è Android —Ç–∞ —ñ–Ω—à–∏—Ö
        activateSensors();
      }
      
      // –£ –±—É–¥—å-—è–∫–æ–º—É –≤–∏–ø–∞–¥–∫—É –∑–∞–ø—É—Å–∫–∞—î–º–æ —Ç—Ä—è—Å—ñ–Ω–Ω—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ
      shakeBall();
    }

    function activateSensors() {
      if (sensorsActive) return;
      
      // –°–ª—É—Ö–∞—î–º–æ –Ω–∞—Ö–∏–ª (Orientation)
      window.addEventListener('deviceorientation', (event) => {
        if (isShaking || container.style.opacity === "0") return;
        const x = (event.gamma || 0) / 2.5; 
        const y = ((event.beta || 45) - 45) / 2.5; 
        container.style.transform = `translate(${x}px, ${y}px)`;
      });

      // –°–ª—É—Ö–∞—î–º–æ —Ç—Ä—è—Å—ñ–Ω–Ω—è (Motion)
      let lastX, lastY, lastZ;
      window.addEventListener('devicemotion', (event) => {
        let acc = event.accelerationIncludingGravity;
        if (!acc || !acc.x) return;
        if (lastX) {
          let diff = Math.abs(lastX - acc.x) + Math.abs(lastY - acc.y) + Math.abs(lastZ - acc.z);
          if (diff > 25) shakeBall(); 
        }
        lastX = acc.x; lastY = acc.y; lastZ = acc.z;
      });

      sensorsActive = true;
      btn.innerText = "–ü–û–¢–†–Ø–°–¢–ò üé±"; // –ó–º—ñ–Ω—é—î–º–æ —Ç–µ–∫—Å—Ç –ø—ñ—Å–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó
    }

    function resetBall() {
      container.style.opacity = "0";
      setTimeout(() => {
        ansText.innerText = "?";
        ansText.className = "initial";
        container.style.opacity = "1";
      }, 600);
    }

    function shakeBall() {
      if (isShaking) return;
      isShaking = true;
      clearTimeout(resetTimer);
      
      container.style.opacity = "0";
      ball.classList.add('shake-anim');

      if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');

      setTimeout(() => {
        ball.classList.remove('shake-anim');
        const randomAnswer = answers[Math.floor(Math.random() * answers.length)];
        ansText.innerText = randomAnswer;
        ansText.className = ""; 
        container.style.opacity = "1";
        isShaking = false;
        
        resetTimer = setTimeout(resetBall, 30000);
      }, 1000);
    }

    // –ó–∞–º—ñ–Ω—é—î–º–æ –ø—Ä—è–º–∏–π –≤–∏–∫–ª–∏–∫ shakeBall –Ω–∞ –æ–±—Ä–æ–±–Ω–∏–∫ –∑ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø—É
    btn.onclick = handleButtonClick;
  </script>
</body>
</html>
